<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>基于MVVM，用于快速搭建设置页，个人信息页的框架（附：仿微信iOS客户端发现页，个人页，设置页Demo） | J_Knight</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="正在学hybrid开发的iOS开发者">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="基于MVVM，用于快速搭建设置页，个人信息页的框架（附：仿微信iOS客户端发现页，个人页，设置页Demo） | J_Knight">
    <meta name="twitter:description" content="正在学hybrid开发的iOS开发者">

    <meta property="og:type" content="article">
    <meta property="og:title" content="基于MVVM，用于快速搭建设置页，个人信息页的框架（附：仿微信iOS客户端发现页，个人页，设置页Demo） | J_Knight">
    <meta property="og:description" content="正在学hybrid开发的iOS开发者">

    
    <meta name="author" content="Knight_SJ">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e6f54887b680a685201da90f1b9384";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>


    
    <link rel="icon" href="/images/avatar.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="J_Knight" href="/atom.xml">
    

    <link rel="canonical" href="https://github.com/knightsj/knightsj.github.io/2017/03/20/基于MVVM，用于快速搭建设置页，个人信息页的框架（附：仿微信iOS客户端发现页，个人页，设置页Demo）/"/>

    
      
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/bg_2.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 J_Knight 的主页"><img src="/images/avatar.png" width="80" alt="J_Knight logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for J_Knight">J_Knight</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">每天进步一点点</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">正在学hybrid开发的iOS开发者</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="http://www.jianshu.com/u/3dd433cb3ea1">简书</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/1929625262/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" title="我的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/knightsj" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-disabled"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-03-20T05:47:51.000Z" class="post-list__meta--date date">2017-03-20</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Objective-C/">Objective-C</a>, <a class="tag-link" href="/tags/iOS/">iOS</a>
 </span>
      <span class="page-pv">
      &nbsp;阅读&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">基于MVVM，用于快速搭建设置页，个人信息页的框架（附：仿微信iOS客户端发现页，个人页，设置页Demo）</h1>
  </header>

  <section class="post">
    <p>写UITableView的时候，我们经常遇到的是完全依赖于网络请求，需要自定义的动态cell的需求（比如微博帖子列表）。但是同时，大多数app里面几乎也都有设置页，个人页等其他以静态表格为主的页面。</p>
<p>而且这些页面的共性比较多：</p>
<ol>
<li>大多数情况下在进入页面之前就已经拿到所有数据。</li>
<li>cell样式单一，自定义cell出现的几率比较小（几乎都是高度为44的cell）。</li>
<li>多数都分组。</li>
</ol>
<p>因为自己非常想写一个开源的东西出来（也可以暴露自己的不足），同时又受限于水平，所以就打算写这么一个比较简单，又具有通用性的框架：<strong>一个定制性比较高的适合在个人页和设置页使用的UITableView</strong>。</p>
<p>在真正写之前，看了几篇类似的文章，挑出两篇自己觉得比较好的：</p>
<ol>
<li><a href="https://www.objc.io/issues/1-view-controllers/table-views/" target="_blank" rel="external">Clean Table View Code</a> </li>
<li><a href="http://www.jianshu.com/p/504c61a9dc82" target="_blank" rel="external">如何写好一个UITableView</a></li>
<li><a href="http://www.jianshu.com/p/81d0c573f7a8" target="_blank" rel="external">利用MVVM设计快速开发个人中心、设置等模块</a></li>
</ol>
<p>看完总结之后，利用上周3天的业余时间写好了这个框架，为了它实用性，我仿照了微信客户端的发现页，个人页和设置页写了一个Demo，来看一下效果图：</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_1.png" alt="发现页 | 个人页 | 个人信息页 | 设置页"></p>
<blockquote>
<p>项目所用资源来自：<a href="https://github.com/zhengwenming/WeChat">GitHub:zhengwenming/WeChat</a><br>Demo地址：<a href="https://github.com/knightsj/SJStaticTableView">GitHub: knightsj/SJStaticTableView</a></p>
</blockquote>
<p>为了体现出这个框架的定制性，我自己也在里面添加了两个页面，入口在设置页里面：</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_2.png" alt="分组定制 | 同组定制"></p>
<blockquote>
<p>先不要纠结分组定制和同组定制的具体意思，在后面讲到定制性的时候我会详细说明。现在只是让大家看一下效果。</p>
</blockquote>
<p>在大概了解了功能之后，开始详细介绍这个框架。写这篇介绍的原因倒不是希望有多少人来用，而是表达一下我自己的思路而已。各位觉得不好的地方请多批评。</p>
<p>在正式讲解之前，先介绍一下本篇的基本目录：</p>
<ol>
<li>用到的技术点。</li>
<li>功能说明。</li>
<li>使用方法。</li>
<li>定制性介绍。</li>
</ol>
<h1 id="1-用到的技术点"><a href="#1-用到的技术点" class="headerlink" title="1. 用到的技术点"></a>1. 用到的技术点</h1><hr>
<p>框架整体来说还是比较简单的，主要还是基于苹果的<code>UITableView</code>组件，为了解耦和责任分离，主要运用了以下技术点：</p>
<ul>
<li><strong>MVVM</strong>：采用MVVM架构，将每一行“纯粹”的数据交给一个单独的<code>ViewModel</code>,让其持有每个cell的数据（行高，cell类型，文本宽度，图片高度等等）。而且每一个section也对应一个<code>ViewModel</code>，它持有当前section的配置数据（title，header和footer的高度等等）。</li>
<li><strong>轻UITableView</strong>：分离<code>UITableViewDataSource</code>与<code>UIViewController</code>，让单独一个类来实现<code>UITableViewDataSource</code>的职能。</li>
<li><strong>block</strong>：使用block来调用cell的绘制方法。</li>
<li><strong>分类</strong>：使用分类来定义每一种不同的cell的绘制方法。</li>
</ul>
<p>知道了主要运用的技术点以后，给大家详细介绍一下该框架的功能。</p>
<h1 id="2-功能介绍"><a href="#2-功能介绍" class="headerlink" title="2. 功能介绍"></a>2. 功能介绍</h1><hr>
<p>这个框架可以用来快速搭建设置页，个人信息页能静态表格页面，使用者只需要给tableView的DataSource传入元素是viewModel的数组就可以了。</p>
<p>虽说这类页面的布局还是比较单一的，但是还是会有几种不同的情况（cell的布局类型），我对比较常见的cell布局做了封装，使用者可以直接使用。</p>
<p>我在定义这些cell的类型的时候，大致划分了两类：</p>
<ol>
<li>第一类是系统风格的cell，大多数情况下，cell高度为44；在cell左侧会有一张图，一个label，也可以只存在一种（但是只存在图片的情况很少）；在cell右侧一般都有一个向右的箭头，而且有时这个箭头的左侧还可能有label，image，也可以两个都有。</li>
<li>第二类就是自定义的cell了，它的高度不一定是44，而且布局和系统风格的cell很不一样，需要用户自己添加。</li>
</ol>
<p>基于这两大类，再细分了几种情况，可以由下面这张图来直观看一下：</p>
<p>既然是cell的类型，那么就类型的枚举就需要定义在cell的viewModel里面：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, SJStaticCellType) &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//系统风格的各种cell类型，已封装好，可以直接用</span></div><div class="line">    SJStaticCellTypeSystemLogout,                          <span class="comment">//退出登录cell</span></div><div class="line">    SJStaticCellTypeSystemAccessoryNone,                   <span class="comment">//右侧没有任何控件</span></div><div class="line">    SJStaticCellTypeSystemAccessorySwitch,                 <span class="comment">//右侧是开关</span></div><div class="line">    SJStaticCellTypeSystemAccessoryDisclosureIndicator,    <span class="comment">//右侧是三角箭头(箭头左侧可以有一个image或者一个label，或者二者都有，根据传入的参数决定)</span></div><div class="line">    </div><div class="line">    <span class="comment">//需要用户自己添加的自定义cell类型</span></div><div class="line">    SJStaticCellTypeMeAvatar,                              <span class="comment">//个人页“我”cell    </span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>来一张图直观得体会一下：</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_6.png" alt="支持cell类型"></p>
<p>在这里有三点需要说一下：</p>
<ol>
<li>这里面除了自定义的cell以外，其他类型的cell都不需要开发者自己布局，都已经被我封装好，只需要在cell的<code>ViewModel</code>里面传入相应的类型和数据（文字，图片）即可。</li>
<li>因为左侧的两个控件（图片和文字）是至少存在一个而且左右顺序固定（图片永远在最左侧），所以该框架通过开发者传入的左侧需要显示的图片和文字，可以自己进行cell的布局。所以类型的判断主要作用于cell的右侧。</li>
<li>值得一提的是，在”最右侧是一个箭头”子分支的五个类型其实都属于一个类型，只需要传入文字和图片，以及文字图片的显示顺序参数（这个参数只在同时存在图片和文字的时候有效）就可以自行判断布局。</li>
</ol>
<p>在了解了该框架的功能之后，我们先看一下如何使用这个框架：</p>
<h1 id="3-使用方法"><a href="#3-使用方法" class="headerlink" title="3. 使用方法"></a>3. 使用方法</h1><hr>
<p>最开始先用文字说明一下：</p>
<ol>
<li>将SJStaticTableViewComponent文件夹复制到工程里。</li>
<li>将要开发的页面的ViewController继承<code>SJStaticTableViewController</code>。</li>
<li>在新ViewController里实现<code>createDataSource</code>方法，将viewModel数组传给控制器的<code>dataSource</code>属性。</li>
<li>根据不同的cell类型，调用不同的cell绘制方法。</li>
<li>如果需要接受cell的点击，需要实现<code>didSelectViewModel</code>方法。</li>
</ol>
<p>可能感觉比较抽象，我拿设置页来具体说明一下：</p>
<p>先看一下设置页的布局：</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_3.png" alt="设置页"></p>
<p>然后我们看一下设置的ViewController的代码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    <span class="keyword">self</span>.navigationItem.title = <span class="string">@"设置"</span>;</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)createDataSource</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.dataSource = [[SJStaticTableViewDataSource alloc] initWithViewModelsArray:[Factory settingPageData] configureBlock:^(SJStaticTableViewCell *cell, SJStaticTableviewCellViewModel *viewModel) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">switch</span> (viewModel.staticCellType)</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemAccessoryDisclosureIndicator:</div><div class="line">            &#123;</div><div class="line">                [cell configureAccessoryDisclosureIndicatorCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">                </div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemAccessorySwitch:</div><div class="line">            &#123;</div><div class="line">                [cell configureAccessorySwitchCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;             </div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemLogout:</div><div class="line">            &#123;</div><div class="line">                [cell configureLogoutTableViewCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;                </div><div class="line">            <span class="keyword">case</span> SJStaticCellTypeSystemAccessoryNone:</div><div class="line">            &#123;</div><div class="line">                [cell configureAccessoryNoneCellWithViewModel:viewModel];</div><div class="line">            &#125;</div><div class="line">                <span class="keyword">break</span>;                </div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)didSelectViewModel:(SJStaticTableviewCellViewModel *)viewModel atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;    </div><div class="line">    <span class="keyword">switch</span> (viewModel.identifier)</div><div class="line">    &#123;            </div><div class="line">        <span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"退出登录"</span>);</div><div class="line">            [<span class="keyword">self</span> showAlertWithMessage:<span class="string">@"真的要退出登录嘛？"</span>];</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">            </div><div class="line">        <span class="keyword">case</span> <span class="number">8</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"清理缓存"</span>);</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;            </div><div class="line">        <span class="keyword">case</span> <span class="number">9</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"跳转到定制性cell展示页面 - 分组"</span>);</div><div class="line">            SJCustomCellsViewController *vc = [[SJCustomCellsViewController alloc] init];</div><div class="line">            [<span class="keyword">self</span>.navigationController pushViewController:vc animated:<span class="literal">YES</span>];</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;            </div><div class="line">        <span class="keyword">case</span> <span class="number">10</span>:</div><div class="line">        &#123;</div><div class="line">            <span class="built_in">NSLog</span>(<span class="string">@"跳转到定制性cell展示页面 - 同组"</span>);</div><div class="line">            SJCustomCellsOneSectionViewController *vc = [[SJCustomCellsOneSectionViewController alloc] init];</div><div class="line">            [<span class="keyword">self</span>.navigationController pushViewController:vc animated:<span class="literal">YES</span>];</div><div class="line">        &#125;</div><div class="line">            <span class="keyword">break</span>;            </div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看到这里，你可能会有这些疑问：</p>
<ol>
<li>UITableViewDataSource方法哪儿去了？</li>
<li>viewModel数组是如何设置的？</li>
<li>cell的绘制方法是如何区分的？</li>
<li>UITableViewDelegate的方法哪里去了？</li>
</ol>
<p>下面我会一一解答，看完了下面的解答，就能几乎完全掌握这个框架的思路了：</p>
<h3 id="问题1：UITableViewDataSource方法哪儿去了？"><a href="#问题1：UITableViewDataSource方法哪儿去了？" class="headerlink" title="问题1：UITableViewDataSource方法哪儿去了？"></a>问题1：UITableViewDataSource方法哪儿去了？</h3><p>我自己封装了一个类<code>SJStaticTableViewDataSource</code>专门作为数据源，需要控制器给它一个viewModel数组。</p>
<p>来看一下它的实现文件：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SJStaticTableViewDataSource.m</span></div><div class="line">- (<span class="built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="built_in">UITableView</span> *)tableView</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.viewModelsArray.count;</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSInteger</span>)tableView:(<span class="built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="built_in">NSInteger</span>)section</div><div class="line">&#123;</div><div class="line">    SJStaticTableviewSectionViewModel *vm = <span class="keyword">self</span>.viewModelsArray[section];</div><div class="line">    <span class="keyword">return</span> vm.cellViewModelsArray.count;</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">UITableViewCell</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    <span class="comment">//获取section的ViewModel</span></div><div class="line">    SJStaticTableviewSectionViewModel *sectionViewModel = <span class="keyword">self</span>.viewModelsArray[indexPath.section];</div><div class="line">    <span class="comment">//获取cell的viewModel</span></div><div class="line">    SJStaticTableviewCellViewModel *cellViewModel = sectionViewModel.cellViewModelsArray[indexPath.row];</div><div class="line">    </div><div class="line">    SJStaticTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellViewModel.cellID];</div><div class="line">    <span class="keyword">if</span> (!cell) &#123;</div><div class="line">        cell = [[SJStaticTableViewCell alloc] initWithStyle:<span class="built_in">UITableViewCellStyleDefault</span> reuseIdentifier:cellViewModel.cellID];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">self</span>.cellConfigureBlock(cell,cellViewModel);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> cell;</div><div class="line">    </div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForHeaderInSection:(<span class="built_in">NSInteger</span>)section&#123;</div><div class="line">    SJStaticTableviewSectionViewModel *vm = <span class="keyword">self</span>.viewModelsArray[section];</div><div class="line">    <span class="keyword">return</span> vm.sectionHeaderTitle;  </div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSString</span> *)tableView:(<span class="built_in">UITableView</span> *)tableView titleForFooterInSection:(<span class="built_in">NSInteger</span>)section</div><div class="line">&#123;</div><div class="line">    SJStaticTableviewSectionViewModel *vm = <span class="keyword">self</span>.viewModelsArray[section];</div><div class="line">    <span class="keyword">return</span> vm.sectionFooterTitle;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>表格的cell和section都设置了与其对应的viewModel，用于封装其对应的数据：</p>
</blockquote>
<p>cell的viewModel(大致看一下即可，后面有详细说明)：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, SJStaticCellType) &#123;    </div><div class="line">    <span class="comment">//系统风格的各种cell类型，已封装好，可以直接用</span></div><div class="line">    SJStaticCellTypeSystemLogout,                          <span class="comment">//退出登录cell（已封装好）</span></div><div class="line">    SJStaticCellTypeSystemAccessoryNone,                   <span class="comment">//右侧没有任何控件</span></div><div class="line">    SJStaticCellTypeSystemAccessorySwitch,                 <span class="comment">//右侧是开关</span></div><div class="line">    SJStaticCellTypeSystemAccessoryDisclosureIndicator,    <span class="comment">//右侧是三角箭头(箭头左侧可以有一个image或者一个label，或者二者都有，根据传入的参数决定)</span></div><div class="line">    </div><div class="line">    <span class="comment">//需要用户自己添加的自定义cell类型</span></div><div class="line">    SJStaticCellTypeMeAvatar,                              <span class="comment">//个人页“我”cell    </span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SwitchValueChagedBlock)(<span class="built_in">BOOL</span> isOn);           <span class="comment">//switch开关切换时调用的block</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableviewCellViewModel</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) SJStaticCellType staticCellType;                  <span class="comment">//类型</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *cellID;                                  <span class="comment">//cell reuser identifier</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> identifier;                              <span class="comment">//区别每个cell，用于点击</span></div><div class="line"><span class="comment">// =============== 系统默认cell左侧 =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span>  *leftImage;                               <span class="comment">//左侧的image，按需传入</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> leftImageSize;                              <span class="comment">//左侧image的大小，存在默认设置</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *leftTitle;                               <span class="comment">//cell主标题，按需传入</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *leftLabelTextColor;                       <span class="comment">//当前组cell左侧label里文字的颜色</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *leftLabelTextFont;                         <span class="comment">//当前组cell左侧label里文字的字体</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> leftImageAndLabelGap;                      <span class="comment">//左侧image和label的距离，存在默认值</span></div><div class="line"><span class="comment">// =============== 系统默认cell右侧 =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *indicatorLeftTitle;                      <span class="comment">//右侧箭头左侧的文本，按需传入</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *indicatorLeftLabelTextColor;              <span class="comment">//右侧文字的颜色，存在默认设置，也可以自定义</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *indicatorLeftLabelTextFont;                <span class="comment">//右侧文字的字体，存在默认设置，也可以自定义</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *indicatorLeftImage;                       <span class="comment">//右侧箭头左侧的image，按需传入</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> indicatorLeftImageSize;                     <span class="comment">//右侧尖头左侧image大小，存在默认设置，也可以自定义</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>, <span class="keyword">readonly</span>)  <span class="built_in">BOOL</span> hasIndicatorImageAndLabel;         <span class="comment">//右侧尖头左侧的文本和image是否同时存在，只能通过内部计算</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> indicatorLeftImageAndLabelGap;             <span class="comment">//右侧尖头左侧image和label的距离，存在默认值</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> isImageFirst;                                 <span class="comment">//右侧尖头左侧的文本和image同时存在时，是否是image挨着箭头，默认为YES</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) SwitchValueChagedBlock switchValueDidChangeBlock;    <span class="comment">//切换switch开关的时候调用的block</span></div><div class="line"><span class="comment">// =============== 长宽数据 =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> cellHeight;                                <span class="comment">//cell高度,默认是44，可以设置</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span>  leftTitleLabelSize;                        <span class="comment">//左侧默认Label的size，传入text以后内部计算</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span>  indicatorLeftLabelSize;                    <span class="comment">//右侧label的size</span></div><div class="line"><span class="comment">// =============== 自定义cell的数据放在这里 =============== //</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *avatarImage;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImage</span> *codeImage;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *userName;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *userID;</div></pre></td></tr></table></figure></p>
<p>section的viewModel(大致看一下即可，后面有详细说明)：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableviewSectionViewModel</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *sectionHeaderTitle;         <span class="comment">//该section的标题</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>)   <span class="built_in">NSString</span> *sectionFooterTitle;         <span class="comment">//该section的标题</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span>  *cellViewModelsArray;        <span class="comment">//该section的数据源</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span>  sectionHeaderHeight;         <span class="comment">//header的高度</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span>  sectionFooterHeight;         <span class="comment">//footer的高度</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> leftImageSize;                 <span class="comment">//当前组cell左侧image的大小</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *leftLabelTextColor;          <span class="comment">//当前组cell左侧label里文字的颜色</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *leftLabelTextFont;            <span class="comment">//当前组cell左侧label里文字的字体</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> leftImageAndLabelGap;         <span class="comment">//当前组左侧image和label的距离，存在默认值</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *indicatorLeftLabelTextColor; <span class="comment">//当前组cell右侧label里文字的颜色</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIFont</span> *indicatorLeftLabelTextFont;   <span class="comment">//当前组cell右侧label里文字的字体</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> indicatorLeftImageSize;        <span class="comment">//当前组cell右侧image的大小</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> indicatorLeftImageAndLabelGap;<span class="comment">//当前组cell右侧image和label的距离，存在默认值</span></div><div class="line">- (<span class="keyword">instancetype</span>)initWithCellViewModelsArray:(<span class="built_in">NSArray</span> *)cellViewModelsArray;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>你可能会觉得属性太多了，但这些属性的存在意义是为cell的定制性服务的，在后文会有解释。</p>
</blockquote>
<p>现在了解了我封装好的数据源，cell的viewModel，section的viewModel以后，我们看一下第二个问题：</p>
<h2 id="问题2：-viewModel数组是如何设置的？"><a href="#问题2：-viewModel数组是如何设置的？" class="headerlink" title="问题2： viewModel数组是如何设置的？"></a>问题2： viewModel数组是如何设置的？</h2><p>我们来看一下设置页的viewModel数组的设置：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)settingPageData</div><div class="line">&#123;</div><div class="line">    <span class="comment">// ========== section 0</span></div><div class="line">    SJStaticTableviewCellViewModel *vm0 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm0.leftTitle = <span class="string">@"账号与安全"</span>;</div><div class="line">    vm0.identifier = <span class="number">0</span>;</div><div class="line">    vm0.indicatorLeftTitle = <span class="string">@"已保护"</span>;</div><div class="line">    vm0.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"ProfileLockOn"</span>];</div><div class="line">    vm0.isImageFirst = <span class="literal">NO</span>;    </div><div class="line">    SJStaticTableviewSectionViewModel *section0 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm0]];</div><div class="line">    </div><div class="line">    <span class="comment">// ========== section 1</span></div><div class="line">    SJStaticTableviewCellViewModel *vm1 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm1.leftTitle = <span class="string">@"新消息通知"</span>;</div><div class="line">    vm1.identifier = <span class="number">1</span>;    </div><div class="line">    <span class="comment">//额外添加switch</span></div><div class="line">    SJStaticTableviewCellViewModel *vm7 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm7.leftTitle = <span class="string">@"夜间模式"</span>;</div><div class="line">    vm7.switchValueDidChangeBlock = ^(<span class="built_in">BOOL</span> isON)&#123;</div><div class="line">        <span class="built_in">NSString</span> *message = isON?<span class="string">@"打开夜间模式"</span>:<span class="string">@"关闭夜间模式"</span>;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,message);</div><div class="line">    &#125;;</div><div class="line">    vm7.staticCellType = SJStaticCellTypeSystemAccessorySwitch;</div><div class="line">    vm7.identifier = <span class="number">7</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm8 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm8.leftTitle = <span class="string">@"清理缓存"</span>;</div><div class="line">    vm8.indicatorLeftTitle = <span class="string">@"12.3M"</span>;</div><div class="line">    vm8.identifier = <span class="number">8</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm2 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm2.leftTitle = <span class="string">@"隐私"</span>;</div><div class="line">    vm2.identifier = <span class="number">2</span>;</div><div class="line">     </div><div class="line">    SJStaticTableviewCellViewModel *vm3 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm3.leftTitle = <span class="string">@"通用"</span>;</div><div class="line">    vm3.identifier = <span class="number">3</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section1 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm1,vm7,vm8,vm2,vm3]];</div><div class="line"></div><div class="line">    <span class="comment">// ========== section 2</span></div><div class="line">    SJStaticTableviewCellViewModel *vm4 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm4.leftTitle = <span class="string">@"帮助与反馈"</span>;</div><div class="line">    vm4.identifier = <span class="number">4</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm5 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm5.leftTitle = <span class="string">@"关于微信"</span>;</div><div class="line">    vm5.identifier = <span class="number">5</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section2 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm4,vm5]];</div><div class="line"></div><div class="line">      <span class="comment">// ========== section 4</span></div><div class="line">    SJStaticTableviewCellViewModel *vm9 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm9.leftTitle = <span class="string">@"定制性cell展示页面 - 分组"</span>;</div><div class="line">    vm9.identifier = <span class="number">9</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm10 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm10.leftTitle = <span class="string">@"定制性cell展示页面 - 同组"</span>;</div><div class="line">    vm10.identifier = <span class="number">10</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section4 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm9,vm10]];</div><div class="line"></div><div class="line">    <span class="comment">// ========== section 3</span></div><div class="line">    SJStaticTableviewCellViewModel *vm6 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm6.staticCellType = SJStaticCellTypeSystemLogout;</div><div class="line">    vm6.cellID = <span class="string">@"logout"</span>;</div><div class="line">    vm6.identifier = <span class="number">6</span>;</div><div class="line">   </div><div class="line">    SJStaticTableviewSectionViewModel *section3 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm6]];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> @[section0,section1,section2,section4,section3];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们可以看到，交给dataSource的数组是一个二维数组：</p>
<ul>
<li>第一维是section数组，元素是每一个section对应的viewModel：<code>SJStaticTableviewSectionViewModel</code>。</li>
<li>第二维是cell数组，元素是每一个cell对应的viewModel:<code>SJStaticTableviewCellViewModel</code>。</li>
</ul>
<p>有几个<code>SJStaticTableviewCellViewModel</code>的属性需要强调一下：</p>
<ol>
<li>isImageFirst：因为该页面第一组的cell右侧的箭头左边同时存在一个image和一个label，所以需要额外设置二者的顺序。因为默认紧挨着箭头的是图片，所以我们需要重新设置它为NO，作用是让label紧挨着箭头。</li>
<li>identifier：这个属性是一个整数，它用来标记每个cell，用于在用户点击cell的时候进行判断。我没有将用户的点击与cell的index相关联，是因为有的时候因为需求我们可能会更改cell的顺序或者删除某个cell，所以依赖cell的index是不妥的，容易出错。</li>
<li>cellID：这个属性用来cell的复用。因为总是有个别cell的布局是不同的：在这里出现了一个退出登录的cell，所以需要和其他的cell区别开来（cellID可以不用设置，有默认值，用来标记最常用的cell类型）。</li>
</ol>
<p>显然，<code>Factory</code>类属于<code>Model</code>，它将“纯数据”交给了dataSource使用的两个viewModel。这个类是我自己定义的，读者在使用这个框架的时候可以根据需求自己定义。</p>
<p>现在知道了数据源的设置方法，我们看一下第三个问题：</p>
<h3 id="问题3：cell的绘制方法是如何区分的？"><a href="#问题3：cell的绘制方法是如何区分的？" class="headerlink" title="问题3：cell的绘制方法是如何区分的？"></a>问题3：cell的绘制方法是如何区分的？</h3><p>心细的同学会发现，在dataSource的<code>cellForRow:</code>方法里，我用了block方法来绘制了cell。</p>
<p>先看一下这个block的定义：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">void</span>(^SJStaticCellConfigureBlock)(SJStaticTableViewCell *cell, SJStaticTableviewCellViewModel * viewModel);</div></pre></td></tr></table></figure></p>
<p>这个block在控制器里面回调，通过判断cell的类型来绘制不同的cell。</p>
<p>那么不同类型的cell是如何区分的呢？<br>— 我用的是分类。</p>
<p>有分类，就一定有一个被分类的类： <code>SJStaticTableViewCell</code></p>
<p>看一下它的头文件：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//所有cell都是这个类的分类</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> : <span class="title">UITableViewCell</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) SJStaticTableviewCellViewModel *viewModel;</div><div class="line"><span class="comment">// =============== 系统风格cell的所有控件 =============== //</span></div><div class="line"><span class="comment">//左半部分</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *leftImageView;               <span class="comment">//左侧的ImageView</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *leftTitleLabel;                  <span class="comment">//左侧的Label</span></div><div class="line"></div><div class="line"><span class="comment">//右半部分</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *indicatorArrow;              <span class="comment">//右侧的箭头</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *indicatorLeftImageView;      <span class="comment">//右侧的箭头的左边的imageview</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *indicatorLeftLabel;              <span class="comment">//右侧的箭头的左边的Label</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UISwitch</span> *indicatorSwitch;                <span class="comment">//右侧的箭头的左边的开关</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *logoutLabel;                     <span class="comment">//退出登录的label</span></div><div class="line"><span class="comment">// =============== 用户自定义的cell里面的控件 =============== //</span></div><div class="line"><span class="comment">//MeViewController里面的头像cell</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *avatarImageView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *codeImageView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIImageView</span> *avatarIndicatorImageView;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *userNameLabel;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UILabel</span> *userIdLabel;</div><div class="line"></div><div class="line"><span class="comment">//统一的，布局cell左侧部分的内容（标题 ／ 图片 + 标题），所有系统风格的cell都要调用这个方法</span></div><div class="line">- (<span class="keyword">void</span>)layoutLeftPartSubViewsWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>在这里我定义了所有的控件和一个布局cell左侧的控件的方法。因为几乎所有的分类的左侧几乎都是类似的，所以将它抽取出来。</p>
<p>那么究竟有几个分类呢？（可以参考上面cellViewModel头文件里的枚举类型）</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//右侧有剪头的cell（最常见）</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">AccessoryDisclosureIndicator</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureAccessoryDisclosureIndicatorCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//右侧没有控件的cell</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">AccessoryNone</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureAccessoryNoneCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//右侧是开关的 cell</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">AccessorySwitch</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureAccessorySwitchCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//退出登录cell</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">Logout</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureLogoutTableViewCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//一个自定义的cell（在个人页的第一排）</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SJStaticTableViewCell</span> (<span class="title">MeAvatar</span>)</span></div><div class="line">- (<span class="keyword">void</span>)configureMeAvatarTableViewCellWithViewModel:(SJStaticTableviewCellViewModel *)viewModel;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>在使用这个框架的时候，如果遇到不满足当前需求的情况，可以自己添加分类。</p>
<h3 id="问题4：UITableViewDelegate的方法哪里去了？"><a href="#问题4：UITableViewDelegate的方法哪里去了？" class="headerlink" title="问题4：UITableViewDelegate的方法哪里去了？"></a>问题4：UITableViewDelegate的方法哪里去了？</h3><p>说到<code>UITableViewDelegate</code>的代理方法，我们最熟悉的莫过于<code>didSelectRowAtIndexPath:</code>了。</p>
<p>但是我在写这个框架的时候，自己定义了一个继承于<code>UITableViewDelegate</code>的代理：<code>SJStaticTableViewDelegate</code>，并给它添加了一个代理方法：<br>``<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SJStaticTableViewDelegate</span> &lt;<span class="title">UITableViewDelegate</span>&gt;</span></div><div class="line"><span class="keyword">@optional</span></div><div class="line">- (<span class="keyword">void</span>)didSelectViewModel: (SJStaticTableviewCellViewModel *)viewModel atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>这个方法返回的是当前点击的cell对应的viewModel，弱化了indexPath的作用。</p>
<p>为什么要这么做？</p>
<p>想一想原来点击cell的代理方法：<code>didSelectRowAtIndexPath:</code>。我们通过这个点击方法，拿到的是cell对应的indexPath，然后再通过这个indexPath，就可以在数据源里面查找对应的模型（viewModel或者model）。</p>
<p>因此，我定义的这个方法直接返回了被点击cell对应的viewModel，等于说帮使用者节省了一个步骤。当然如果要使用的话也可以使用系统原来的<code>didSelectRowAtIndexPath:</code>方法。</p>
<p>来看一下这个新的代理方法是如何实现的：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SJStaticTableView.m</span></div><div class="line">- (<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</div><div class="line">&#123;</div><div class="line">    [tableView deselectRowAtIndexPath:indexPath animated:<span class="literal">YES</span>];</div><div class="line">    <span class="keyword">if</span> ((<span class="keyword">self</span>.sjDelegate) &amp;&amp; [<span class="keyword">self</span>.sjDelegate respondsToSelector:<span class="keyword">@selector</span>(didSelectViewModel:atIndexPath:)]) &#123;        </div><div class="line">        SJStaticTableviewCellViewModel *cellViewModel = [<span class="keyword">self</span>.sjDataSource tableView:tableView cellViewModelAtIndexPath:indexPath];</div><div class="line">        [<span class="keyword">self</span>.sjDelegate didSelectViewModel:cellViewModel atIndexPath:indexPath];</div><div class="line">        </div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>((<span class="keyword">self</span>.sjDelegate)&amp;&amp; [<span class="keyword">self</span>.sjDelegate respondsToSelector:<span class="keyword">@selector</span>(tableView:didSelectRowAtIndexPath:)])&#123;</div><div class="line">        </div><div class="line">        [<span class="keyword">self</span>.sjDelegate tableView:tableView didSelectRowAtIndexPath:indexPath];        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在读者应该大致了解了这个框架的实现思路，现在我讲一下这个框架的定制性。</p>
<h1 id="4-定制性"><a href="#4-定制性" class="headerlink" title="4. 定制性"></a>4. 定制性</h1><hr>
<p>这个框架有一个配置文件：SJConst.h，它定义了这个框架的所有默认数据和默认配置，比如cell左侧lable的字体，颜色；左侧label和image的距离；右侧label的字体和颜色，右侧图片的默认大小等等。来看一下代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#ifndef SJConst_h</span></div><div class="line"><span class="meta">#define SJConst_h</span></div><div class="line"><span class="comment">//distance</span></div><div class="line"><span class="meta">#define SJScreenWidth      [UIScreen mainScreen].bounds.size.width</span></div><div class="line"><span class="meta">#define SJScreenHeight     [UIScreen mainScreen].bounds.size.height</span></div><div class="line"><span class="meta">#define SJTopGap 8               //same as bottom gap</span></div><div class="line"><span class="meta">#define SJLeftGap 12             //same as right gap</span></div><div class="line"><span class="meta">#define SJLeftMiddleGap 10       //in left  part: the gap between image and label</span></div><div class="line"><span class="meta">#define SJRightMiddleGap 6       //in right part: the gap between image and label</span></div><div class="line"><span class="meta">#define SJImgWidth 30            //default width and height</span></div><div class="line"><span class="meta">#define SJTitleWidthLimit 180    //limt width of left and right labels</span></div><div class="line"><span class="comment">//image</span></div><div class="line"><span class="meta">#define SJIndicatorArrow @<span class="meta-string">"arrow"</span></span></div><div class="line"><span class="comment">//font</span></div><div class="line"><span class="meta">#define SJLeftTitleTextFont               [UIFont systemFontOfSize:15]</span></div><div class="line"><span class="meta">#define SJLogoutButtonFont                [UIFont systemFontOfSize:16]</span></div><div class="line"><span class="meta">#define SJIndicatorLeftTitleTextFont      [UIFont systemFontOfSize:13]</span></div><div class="line"><span class="comment">//color</span></div><div class="line"><span class="meta">#define SJColorWithRGB(R,G,B,A)           [UIColor colorWithRed:R/255.0 green:G/255.0 blue:B/255.0 alpha:A]</span></div><div class="line"><span class="meta">#define SJLeftTitleTextColor              [UIColor blackColor]</span></div><div class="line"><span class="meta">#define SJIndicatorLeftTitleTextColor     SJColorWithRGB(136,136,136,1)</span></div><div class="line"><span class="meta">#endif /* SJConst_h */</span></div></pre></td></tr></table></figure>
<p>这里定义的默认配置在cellViewModel和sectionViewModel初始化的时候使用：</p>
<p>cell的viewModel：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SJStaticTableviewCellViewModel.m</span></div><div class="line">- (<span class="keyword">instancetype</span>)init</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;        </div><div class="line">        _cellHeight = <span class="number">44</span>;</div><div class="line">        _cellID = <span class="string">@"defaultCell"</span>;</div><div class="line">        _staticCellType = SJStaticCellTypeSystemAccessoryDisclosureIndicator;<span class="comment">//默认是存在三角箭头的cell</span></div><div class="line">        _isImageFirst = <span class="literal">YES</span>;</div><div class="line">        </div><div class="line">        <span class="comment">//都是默认配置</span></div><div class="line">        _leftLabelTextFont = SJLeftTitleTextFont;</div><div class="line">        _leftLabelTextColor = SJLeftTitleTextColor;</div><div class="line">        _leftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _leftImageAndLabelGap = SJLeftMiddleGap;</div><div class="line">        _indicatorLeftLabelTextFont = SJIndicatorLeftTitleTextFont;</div><div class="line">        _indicatorLeftLabelTextColor = SJIndicatorLeftTitleTextColor;</div><div class="line">        _indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _indicatorLeftImageAndLabelGap = SJRightMiddleGap;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>section的viewModel：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithCellViewModelsArray:(<span class="built_in">NSArray</span> *)cellViewModelsArray</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _sectionHeaderHeight = <span class="number">10</span>;</div><div class="line">        _sectionFooterHeight = <span class="number">10</span>;</div><div class="line">        _leftLabelTextFont = SJLeftTitleTextFont;</div><div class="line">        _leftLabelTextColor = SJLeftTitleTextColor;</div><div class="line">        _leftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _leftImageAndLabelGap = SJLeftMiddleGap;</div><div class="line">        _indicatorLeftLabelTextFont = SJIndicatorLeftTitleTextFont;</div><div class="line">        _indicatorLeftLabelTextColor = SJIndicatorLeftTitleTextColor;</div><div class="line">        _indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(SJImgWidth, SJImgWidth);</div><div class="line">        _indicatorLeftImageAndLabelGap = SJRightMiddleGap;</div><div class="line">        _cellViewModelsArray = cellViewModelsArray;        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>显然，这个默认配置只有一组，但是可能一个app里面同时存在一个设置页和一个个人页。而这两个页面的风格也可能是不一样的，所以这个默认配置只能给其中一个页面，另一个页面需要另外配置，于是就有了定制性的功能。</p>
<p>再来看一下展示定制性效果的图：</p>
<p><img src="http://oih3a9o4n.bkt.clouddn.com/sjstatictableview_2.png" alt="分组定制 | 同组定制"></p>
<p>参照这个效果图，我们看一下这两个页面的数据源是如何设置的：</p>
<p>分组页面：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)customCellsPageData</div><div class="line">&#123;</div><div class="line">    <span class="comment">//默认配置</span></div><div class="line">    SJStaticTableviewCellViewModel *vm1 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm1.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm1.leftTitle = <span class="string">@"全部默认配置，用于对照"</span>;</div><div class="line">    vm1.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm1.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section1 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm1]];</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm2 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm2.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm2.leftTitle = <span class="string">@"左侧图片变小"</span>;</div><div class="line">    vm2.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm2.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section2 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm2]];</div><div class="line">    section2.leftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">20</span>, <span class="number">20</span>);</div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm3 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm3.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm3.leftTitle = <span class="string">@"字体变小变红"</span>;</div><div class="line">    vm3.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm3.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section3 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm3]];</div><div class="line">    section3.leftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">8</span>];</div><div class="line">    section3.leftLabelTextColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm4 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm4.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm4.leftTitle = <span class="string">@"左侧两个控件距离变大"</span>;</div><div class="line">    vm4.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm4.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section4 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm4]];</div><div class="line">    section4.leftImageAndLabelGap = <span class="number">20</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm5 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm5.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm5.leftTitle = <span class="string">@"右侧图片变小"</span>;</div><div class="line">    vm5.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm5.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section5 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm5]];</div><div class="line">    section5.indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">15</span>, <span class="number">15</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm6= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm6.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm6.leftTitle = <span class="string">@"右侧字体变大变蓝"</span>;</div><div class="line">    vm6.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm6.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section6 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm6]];</div><div class="line">    section6.indicatorLeftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">18</span>];</div><div class="line">    section6.indicatorLeftLabelTextColor = [<span class="built_in">UIColor</span> blueColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm7= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm7.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm7.leftTitle = <span class="string">@"右侧两个控件距离变大"</span>;</div><div class="line">    vm7.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm7.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section7 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm7]];</div><div class="line">    section7.indicatorLeftImageAndLabelGap = <span class="number">18</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> @[section1,section2,section3,section4,section5,section6,section7];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>我们可以看到，定制的代码都作用于section的viewModel。</p>
</blockquote>
<p>同组页面：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSArray</span> *)customCellsOneSectionPageData</div><div class="line">&#123;</div><div class="line">    <span class="comment">//默认配置</span></div><div class="line">    SJStaticTableviewCellViewModel *vm1 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm1.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm1.leftTitle = <span class="string">@"全部默认配置，用于对照"</span>;</div><div class="line">    vm1.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm1.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm2 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm2.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm2.leftTitle = <span class="string">@"左侧图片变小"</span>;</div><div class="line">    vm2.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm2.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    vm2.leftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">20</span>, <span class="number">20</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm3 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm3.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm3.leftTitle = <span class="string">@"字体变小变红"</span>;</div><div class="line">    vm3.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm3.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    vm3.leftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">8</span>];</div><div class="line">    vm3.leftLabelTextColor = [<span class="built_in">UIColor</span> redColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm4 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm4.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm4.leftTitle = <span class="string">@"左侧两个控件距离变大"</span>;</div><div class="line">    vm4.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm4.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    vm4.leftImageAndLabelGap = <span class="number">20</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm5 = [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm5.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm5.leftTitle = <span class="string">@"右侧图片变小"</span>;</div><div class="line">    vm5.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm5.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    vm5.indicatorLeftImageSize = <span class="built_in">CGSizeMake</span>(<span class="number">15</span>, <span class="number">15</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm6= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm6.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm6.leftTitle = <span class="string">@"右侧字体变大变蓝"</span>;</div><div class="line">    vm6.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm6.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    vm6.indicatorLeftLabelTextFont = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">18</span>];</div><div class="line">    vm6.indicatorLeftLabelTextColor = [<span class="built_in">UIColor</span> blueColor];</div><div class="line">    </div><div class="line">    </div><div class="line">    SJStaticTableviewCellViewModel *vm7= [[SJStaticTableviewCellViewModel alloc] init];</div><div class="line">    vm7.leftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"MoreGame"</span>];</div><div class="line">    vm7.leftTitle = <span class="string">@"右侧两个控件距离变大"</span>;</div><div class="line">    vm7.indicatorLeftImage = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"wzry"</span>];</div><div class="line">    vm7.indicatorLeftTitle = <span class="string">@"王者荣耀!"</span>;</div><div class="line">    vm7.indicatorLeftImageAndLabelGap = <span class="number">18</span>;</div><div class="line">    </div><div class="line">    SJStaticTableviewSectionViewModel *section1 = [[SJStaticTableviewSectionViewModel alloc] initWithCellViewModelsArray:@[vm1,vm2,vm3,vm4,vm5,vm6,vm7]];</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> @[section1];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>为了方便比较，同组页面的定制和分组是一致的。我们可以看到，定制代码都作用于cell的viewModel上了。</p>
</blockquote>
<p>为什么要有同组和分组展示？</p>
<p>同组和分组展示的目的，是为了展示这个框架的两种定制性。</p>
<ul>
<li><p>分组页面所展示的是section级的定制性：cell的配置任务交给section层的viewModel。一旦设置，该section里面的所有cell都能保持这一配置。</p>
</li>
<li><p>同组页面所展示的是cell级的定制性：cell的配置任务交给cell层的viewModel。一旦设置，只有当前cell具有这个配置，不影响其他cell。</p>
</li>
</ul>
<p>其实为了省事，只在section层的viewModel上配置即可（如果给每个cell都给设置相同的配置太不优雅了），因为从设计角度来看，一个section里面的cell的风格不一致的情况比较少见（我觉得不符合设计）：比如在一个section里面，不太可能两个cell里面的图片大小是不一样的，或者字体大小也不一样。</p>
<p>还是看一下section级的定制代码吧：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//重新设置了该组全部cell里面左侧label的字体</span></div><div class="line">- (<span class="keyword">void</span>)setLeftLabelTextFont:(<span class="built_in">UIFont</span> *)leftLabelTextFont</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (_leftLabelTextFont != leftLabelTextFont) &#123;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> (![<span class="keyword">self</span> font1:_leftLabelTextFont hasSameFontSizeOfFont2:leftLabelTextFont]) &#123;</div><div class="line">            </div><div class="line">            _leftLabelTextFont = leftLabelTextFont;</div><div class="line">            </div><div class="line">            <span class="comment">//如果新的宽度大于原来的宽度，需要重新设置，否则不需要</span></div><div class="line">            [_cellViewModelsArray enumerateObjectsUsingBlock:^(SJStaticTableviewCellViewModel * viewModel, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</div><div class="line">                viewModel.leftLabelTextFont = _leftLabelTextFont;</div><div class="line">                <span class="built_in">CGSize</span> size = [<span class="keyword">self</span> sizeForTitle:viewModel.leftTitle withFont:_leftLabelTextFont];</div><div class="line">                <span class="keyword">if</span> (size.width &gt; viewModel.leftTitleLabelSize.width) &#123;</div><div class="line">                    viewModel.leftTitleLabelSize = size;</div><div class="line">                &#125;</div><div class="line">            &#125;];</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//重新设置了该组全部cell里面左侧label的字的颜色</span></div><div class="line">- (<span class="keyword">void</span>)setLeftLabelTextColor:(<span class="built_in">UIColor</span> *)leftLabelTextColor</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (![<span class="keyword">self</span> color1:_leftLabelTextColor hasTheSameRGBAOfColor2:leftLabelTextColor]) &#123;</div><div class="line">         _leftLabelTextColor = leftLabelTextColor;</div><div class="line">        [_cellViewModelsArray makeObjectsPerformSelector:<span class="keyword">@selector</span>(setLeftLabelTextColor:) withObject:_leftLabelTextColor];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//重新设置了该组全部cell里面左侧图片等大小</span></div><div class="line">- (<span class="keyword">void</span>)setLeftImageSize:(<span class="built_in">CGSize</span>)leftImageSize</div><div class="line">&#123;</div><div class="line">    SJStaticTableviewCellViewModel *viewMoel = _cellViewModelsArray.firstObject;</div><div class="line">    </div><div class="line">    <span class="built_in">CGFloat</span> cellHeight = viewMoel.cellHeight;</div><div class="line">    <span class="keyword">if</span> ( (!<span class="built_in">CGSizeEqualToSize</span>(_leftImageSize, leftImageSize)) &amp;&amp; (leftImageSize.height &lt; cellHeight)) &#123;</div><div class="line">        _leftImageSize = leftImageSize;</div><div class="line">        [_cellViewModelsArray enumerateObjectsUsingBlock:^(SJStaticTableviewCellViewModel *viewModel, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop)</div><div class="line">        &#123;</div><div class="line">            viewMoel.leftImageSize = _leftImageSize;</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>因为每个section都持有它内部的所有cell的viewModel，所以在set方法里面，如果发现传进来的配置与当前配置不一致，就需要更新所有cell的viewModel对应的属性。</p>
<p>既然section的ViewModel能做这些，为什么还要有一个cell层的配置呢？</p>
<p>– 只是为了提高配置的自由度罢了，万一突然来个需求需要某个cell很独特呢？（大家应该知道我说的神么意思 ^^）</p>
<p>cell的viewModel属性的set方法的实现和section的一致，这里就不上代码了。</p>
<hr>
<p>好了，到这里就讲差不多了，代码量虽然不多，但是都说清楚还是感觉挺需要时间想的。</p>
<p>希望如果各位觉得哪里不好，可以给出您的宝贵意见～</p>

  </section>    

</article>
<section class="read-more">
           
    
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/03/14/先是程序员，然后才是iOS程序员 — 写给广大非科班iOS开发者的一篇面试总结/" title="先是程序员，然后才是iOS程序员 — 写给广大非科班iOS开发者的一篇面试总结">先是程序员，然后才是iOS程序员 — 写给广大非科班iOS开发者的一篇面试总结</a></h2>
                <p class="excerpt">
                
                
这篇面试总结很短，也没有面试题的答案，只是写给像我一样的非科班iOS开发者的一些话。
昨天进行了人生第一次视频面试，一共三个小时的技术面，还没见到人事，应该是挂了。
不过整个过程下来感触还是蛮多的，除了感受到面试官的牛X之外，也知道自己平时在学习中的不足。
先介绍一下面试中觉得比较吃力的问题：
如
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-03-14T00:37:08.000Z" class="post-list__meta--date date">2017-03-14</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Job/">Job</a>, <a class="tag-link" href="/tags/Life/">Life</a>
</span><a class="btn-border-small" href="/2017/03/14/先是程序员，然后才是iOS程序员 — 写给广大非科班iOS开发者的一篇面试总结/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

            
            <footer class="footer">
    <span class="footer__copyright">
        本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2017 - 本站由 <a href="/">@Monniya</a> 创建,
        使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">hexo-theme-new-vno</a> 主题,
        修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
    </span>

    <span class="footer__copyright">
	
     	本站已经被访问了<span id="busuanzi_value_site_pv"></span><span>次</span>

    </span>

   

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</footer>
        </div>
    </div>
</body>
</html>

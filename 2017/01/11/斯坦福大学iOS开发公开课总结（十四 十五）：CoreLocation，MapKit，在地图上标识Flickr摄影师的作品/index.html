<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>斯坦福大学iOS开发公开课总结（十四 十五）：CoreLocation，MapKit，在地图上标识Flickr摄影师的作品 | Knight_SJ</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="在学hybrid开发的iOS开发者">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="斯坦福大学iOS开发公开课总结（十四 十五）：CoreLocation，MapKit，在地图上标识Flickr摄影师的作品 | Knight_SJ">
    <meta name="twitter:description" content="在学hybrid开发的iOS开发者">

    <meta property="og:type" content="article">
    <meta property="og:title" content="斯坦福大学iOS开发公开课总结（十四 十五）：CoreLocation，MapKit，在地图上标识Flickr摄影师的作品 | Knight_SJ">
    <meta property="og:description" content="在学hybrid开发的iOS开发者">

    
    <meta name="author" content="Knight_SJ">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/avatar.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Knight_SJ" href="/atom.xml">
    

    <link rel="canonical" href="https://github.com/knightsj/knightsj.github.io/2017/01/11/斯坦福大学iOS开发公开课总结（十四 十五）：CoreLocation，MapKit，在地图上标识Flickr摄影师的作品/"/>

    
      
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/bg_2.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Knight_SJ 的主页"><img src="/images/avatar.png" width="80" alt="Knight_SJ logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Knight_SJ">Knight_SJ</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">iOS开发|上海</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">在学hybrid开发的iOS开发者</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/1929625262/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1" title="我的微博" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/knightsj" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2017-01-11T07:27:10.000Z" class="post-list__meta--date date">2017-01-11</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Objective-C/">Objective-C</a>, <a class="tag-link" href="/tags/iOS/">iOS</a>
 </span>
      <span class="page-pv">
      &nbsp;阅读&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">斯坦福大学iOS开发公开课总结（十四 十五）：CoreLocation，MapKit，在地图上标识Flickr摄影师的作品</h1>
  </header>

  <section class="post">
    <p>本总结将第十四和十五课放在了一起，原因有二：第一是略去了ipad开发Demo的部分（因为笔者木有ipad，无法进行调试）。第二是两节课都讲解了关于地图框架的相关知识，故将二者放在一起总结。</p>
<p>在本篇总结的最后，会给大家讲解在地图上显示Flickr上摄影师的照片作品。</p>
<h1 id="Network-Activity-Indicator"><a href="#Network-Activity-Indicator" class="headerlink" title="Network Activity Indicator"></a>Network Activity Indicator</h1><hr>
<p>顾名思义，该控件叫做网络活动指示器。当app有网络活动时，可以让状态栏左边的小圆圈滚动用来提示用户当前的网络状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property(nonatomic,getter=isNetworkActivityIndicatorVisible) BOOL networkActivityIndicatorVisible;</div></pre></td></tr></table></figure>
<p>如果设定为YES，状态栏上的小转轮就会转，反之亦然。</p>
<blockquote>
<p>注意：应用中的所有线程都可使用这个转轮，我们需要通过各种方法来向用户准确显示转轮的状态。</p>
</blockquote>
<h1 id="Core-Location"><a href="#Core-Location" class="headerlink" title="Core Location"></a>Core Location</h1><hr>
<p>通过该框架的基本类：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## Core Location几个重要的属性：</div><div class="line">#### 1. 坐标属性</div></pre></td></tr></table></figure></p>
<p>typedef struct {<br>CLLocationDegrees latitude;    //double value<br>CLLocationDegrees longitude;   //double value<br>} CLLocationCoordinate2D;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#### 2. 高度</div></pre></td></tr></table></figure></p>
<p>@property(readonly, nonatomic) CLLocationDistance altitude; //单位是米<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 3. 变化精度：</div></pre></td></tr></table></figure></p>
<p>@property(readonly, nonatomic) CLLocationAccuracy horizontalAccuracy;//水平精度<br>@property(readonly, nonatomic) CLLocationAccuracy verticalAccuracy;//高度精度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">如何获得CLLocation？</div><div class="line">通过实例化```CLLocationManager```类，让其告诉它的代理当前设备所处的位置。</div><div class="line">下面来介绍一下```CLLocationManager```:</div><div class="line"></div><div class="line"># CLLocationManager</div><div class="line"></div><div class="line">-----</div><div class="line">## CLLocationManager的工作步骤：</div><div class="line">1.查看硬件是否支持位置更新。</div><div class="line">2.实例化```CLLocationManager```让其告诉它的代理当前的位置。</div><div class="line">3.设置位置更新的类型(精度)。</div></pre></td></tr></table></figure></p>
<p>@property(assign, nonatomic) CLLocationAccuracy desiredAccuracy; //期望的经度<br>@property(assign, nonatomic) CLLocationDistance distanceFilter;  //更新到该距离之内不要告诉我更新了多少<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">4.开始位置监控。</div></pre></td></tr></table></figure></p>
<ul>
<li>(void)startUpdatingLocation;//开始更新位置</li>
<li>(void)stopUpdatingLocation;//停止位置更新</li>
<li>(void)locationManager:(CLLocationManager <em>)manager didUpdateLocations:(NSArray&lt;CLLocation </em>&gt; *)locations;//位置更新的代理方法</li>
<li>(void)locationManager:(CLLocationManager <em>)manager didFailWithError:(NSError </em>)error;//更新失败<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 位置监控的类型：</div><div class="line"></div><div class="line">#### 1. 基于精度的监控</div></pre></td></tr></table></figure>
</li>
</ul>
<p>extern const CLLocationAccuracy kCLLocationAccuracyBestForNavigation; //最精确，但是非常耗能<br>extern const CLLocationAccuracy kCLLocationAccuracyBest;<br>extern const CLLocationAccuracy kCLLocationAccuracyNearestTenMeters;<br>extern const CLLocationAccuracy kCLLocationAccuracyHundredMeters;<br>extern const CLLocationAccuracy kCLLocationAccuracyKilometer;<br>extern const CLLocationAccuracy kCLLocationAccuracyThreeKilometers;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&gt; 注意：精度越高，耗电量越大</div><div class="line"></div><div class="line">#### 2. 位置发生重大变化时更新。</div></pre></td></tr></table></figure></p>
<ul>
<li>(void)startMonitoringSignificantLocationChanges;</li>
<li><p>(void)stopMonitoringSignificantLocationChanges ;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">该方法在前台和后台都能监控位置的变化，甚至关掉app后，也可以启动应用告诉用户位置更新:</div></pre></td></tr></table></figure>
</li>
<li><p>(BOOL)application:(UIApplication <em>)application didFinishLaunchingWithOptions:(NSDictionary </em>)launchOptions {<br>  //如果<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
</ul>
<h4 id="3-进入某个区域更新。"><a href="#3-进入某个区域更新。" class="headerlink" title="3. 进入某个区域更新。"></a>3. 进入某个区域更新。</h4><p>3.1设定一个圆形的区域，经过该区域的时候会更新</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (void)startMonitoringForRegion:(CLRegion *)region;</div><div class="line">- (void)requestStateForRegion:(CLRegion *)region;</div></pre></td></tr></table></figure>
<p>3.2 通过一个信标来监控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@property (readonly, nonatomic) CLLocationDistance maximumRegionMonitoringDistance;//设置最大监控距离</div><div class="line"></div><div class="line">- (void)startRangingBeaconsInRegion:(CLBeaconRegion *)region;//设置信标</div></pre></td></tr></table></figure>
<h4 id="4-监控前进的方向"><a href="#4-监控前进的方向" class="headerlink" title="4. 监控前进的方向"></a>4. 监控前进的方向</h4><h1 id="MapKit"><a href="#MapKit" class="headerlink" title="MapKit"></a>MapKit</h1><hr>
<p>MapKit是用于显示地图的框架，它通过<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">我们来看一下该框架中几个比较重要的元素：</div><div class="line"></div><div class="line">## 1. MKMapView</div><div class="line"></div><div class="line">MKMapView就是用来显示地图的View。</div><div class="line"></div><div class="line">MKMapView的属性：</div></pre></td></tr></table></figure></p>
<p>@property (nonatomic) MKMapType mapType;// MKMapTypeStandard : 标准；MKMapTypeSatellite:卫星；MKMapTypeHybrid：叠加<br>@property (nonatomic) BOOL showsUserLocation; //显示用户的地点<br>@property (nonatomic, readonly, getter=isUserLocationVisible) BOOL userLocationVisible;<br>//用户坐标是否可见<br>@property (nonatomic, getter=isZoomEnabled) BOOL zoomEnabled; //是否可放大缩小<br>@property (nonatomic, getter=isRotateEnabled) BOOL rotateEnabled; //是否可旋转<br>@property (nonatomic, getter=isPitchEnabled) BOOL pitchEnabled; //3D效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 2. MKAnnotationView</div><div class="line">在```MKMapView```视图里，可以显示用于标注具体位置的“大头针” ，它是MapKit框架里的```AnnotationView```。</div><div class="line"></div><div class="line">MKAnnotationView的属性：</div></pre></td></tr></table></figure>
<p>@property (nonatomic, strong, nullable) id <mkannotation> annotation;<br>@property (nonatomic, strong, nullable) UIImage <em>image;//大头针的图像<br>@property (strong, nonatomic, nullable) UIView </em>leftCalloutAccessoryView;//左附属对话框<br>@property (strong, nonatomic, nullable) UIView *rightCalloutAccessoryView;//右附属对话框<br>@property (nonatomic, getter=isDraggable) BOOL draggable //是否可拖动</mkannotation></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">大头针被点击时调用的方法：</div></pre></td></tr></table></figure>
<ul>
<li>(void)mapView:(MKMapView <em>)mapView didSelectAnnotationView:(MKAnnotationView </em>)view<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 3. id&lt;MKAnnotation&gt;</div><div class="line">AnnotationView的数据源就是：id&lt;MKAnnotation&gt;，任何遵从该协议的对象都可以成为AnnotationView的数据源，也就是说，任何遵守    ```MKAnootation```协议的对象你都可以将其放入地图中。</div><div class="line"></div><div class="line">我们先看一下在MKMapView里的关于MKAnnotation的属性：</div></pre></td></tr></table></figure>
</li>
</ul>
<p>@property (nonatomic, readonly) NSArray<id<mkannotation>&gt; *annotations;//包含MapView所显示的所有Annotaion<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">注意：annotations是只读的数组，只能添加或者删除。</div></pre></td></tr></table></figure></id<mkannotation></p>
<ul>
<li>(void)addAnnotation:(id <mkannotation>)annotation;</mkannotation></li>
<li>(void)addAnnotations:(NSArray<id<mkannotation>&gt; *)annotations;</id<mkannotation></li>
<li>(void)removeAnnotation:(id <mkannotation>)annotation;</mkannotation></li>
<li>(void)removeAnnotations:(NSArray<id<mkannotation>&gt; *)annotations;<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">MKAnnotation协议的方法：</div></pre></td></tr></table></figure>
</id<mkannotation></li>
</ul>
<p>@protocol MKAnnotation <nsobject><br>@property (nonatomic, readonly) CLLocationCoordinate2D coordinate; //坐标</nsobject></p>
<p>@optional<br>@property (nonatomic, readonly, copy, nullable) NSString <em>title;//标题<br>@property (nonatomic, readonly, copy, nullable) NSString </em>subtitle;//副标题</p>
<ul>
<li><p>(void)setCoordinate:(CLLocationCoordinate2D)newCoordinate ;//设置坐标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">那么二者是如何关联的呢？</div><div class="line">通过MKMapView的代理方法：</div></pre></td></tr></table></figure>
</li>
<li><p>(MKAnnotationView <em>)mapView:(MKMapView </em>)mapView viewForAnnotation:(id<mkannotation>)annotation<br>{<br>  //提供一个 annotation，返回一个 MKAnnotationView<br>}</mkannotation></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">## 4. Callout(对话框)</div><div class="line">点击大头针（MKAnnotationView），会出现一个白底的对话框，它被叫做```callout```,可以设置它的主标题和副标题。另外还有左右附属实图，它们可以显示图片或者箭头，也可被点击。</div><div class="line">﻿</div><div class="line"></div><div class="line"># Demo</div><div class="line">----</div><div class="line">## Demo需求：</div><div class="line">- 显示从flickr抓取的摄影师列表。</div><div class="line">- 点击列表中的一项，打开地图，在当前摄影师所照照片的地点显示大头针。</div><div class="line">- 点击其中的一个大头针，显示照片详情：缩略图和名称。</div><div class="line">- 点击箭头按钮，滑入显示照片的页面，显示原始照片。</div><div class="line"></div><div class="line">## Demo效果图：</div><div class="line"></div><div class="line">![在地图显示照片拍摄位置](http://upload-images.jianshu.io/upload_images/859001-269dd622430d4972.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</div><div class="line"></div><div class="line">## 重要代码段和知识点：</div><div class="line"></div><div class="line">#### 1. 更改Core Data模型</div><div class="line">在上一节课的基础上，我们需要在模型里的```Photo```实体添加经度和纬度的属性，还有大头针缩略图的URL属性。</div><div class="line">在更新属性后，一定要重新生成对应该实体的类文件，并且要将原app删除，因为数据库前后是不兼容的。</div><div class="line"></div><div class="line"></div><div class="line">![更新模型](http://upload-images.jianshu.io/upload_images/859001-0bf538fa1a08fe3d.gif?imageMogr2/auto-orient/strip)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#### 2. 新建PhotosByPhotographerMapViewController.h，用来显示```MKMapView</div></pre></td></tr></table></figure>
</li>
</ul>
<p>因为要在地图上显示摄影师所照照片的位置，因此，该类的数据源来自摄影师模型：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>#import <uikit uikit.h=""></uikit></p>
<p>#import “Photographer.h”<br>@interface PhotosByPhotographerMapViewController : UIViewController<br>@property (nonatomic, strong) Photographer *photographer;//公共API：摄影师<br>@end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>#import “PhotosByPhotographerMapViewController.h”</p>
<p>#import <mapkit mapkit.h=""></mapkit></p>
<p>@interface PhotosByPhotographerMapViewController ()<mkmapviewdelegate><br>@property (strong, nonatomic) IBOutlet MKMapView <em>mapView;//地图view<br>@property (nonatomic,strong) NSArray </em>photosByPhotographer;//装入摄影师拥有的照片的数组<br>@end</mkmapviewdelegate></p>
<p>@implementation PhotosByPhotographerMapViewController<br>@end<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 3. 导入Mapkit的framework</div><div class="line"></div><div class="line">需要注意的是，除了要在类文件引用```&lt;MapKit/MapKit.h&gt;```框架以外，还要手动向项目中添加该框架：</div><div class="line"></div><div class="line">![手动添加MapKit框架.gif](http://upload-images.jianshu.io/upload_images/859001-8fb04dfbac7bbdd7.gif?imageMogr2/auto-orient/strip)</div><div class="line"></div><div class="line"></div><div class="line">#### 4. 更新photographer和mapView后更新annotation：</div></pre></td></tr></table></figure></p>
<ul>
<li><p>(void)setMapView:(MKMapView *)mapView<br>{<br>  _mapView = mapView;</p>
<p>  //设置代理<br>  self.mapView.delegate = self;</p>
<p>  //更新<br>  [self updateMapViewAnnotations];<br>}</p>
</li>
<li><p>(void)setPhotographer:(Photographer *)photographer<br>{<br>  _photographer = photographer;<br>  //导航栏标题<br>  self.title = photographer.name;<br>  //准备更新数组，要事先设置其为nil，否则不会生成新的<br>  self.photosByPhotographer = nil;<br>  [self updateMapViewAnnotations];<br>}</p>
</li>
<li><p>(void)updateMapViewAnnotations<br>{<br>  [self.mapView removeAnnotations:self.mapView.annotations];<br>  [self.mapView addAnnotations:self.photosByPhotographer];<br>  [self.mapView showAnnotations:self.photosByPhotographer animated:YES];<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#### 5. 自定义点击大头针后显示的view</div></pre></td></tr></table></figure>
</li>
<li><p>(MKAnnotationView <em>)mapView:(MKMapView </em>)mapView viewForAnnotation:(id<mkannotation>)annotation<br>{</mkannotation></p>
<p>  //类似UITableviewCell的复用<br>  static NSString *reuseId = @”PhotosByPhotographerMapViewController”;    </p>
<p>  MKPinAnnotationView <em>view = (MKPinAnnotationView</em>)[mapView dequeueReusableAnnotationViewWithIdentifier:reuseId];    </p>
<p>  if (!view) {</p>
<pre><code> view = [[MKPinAnnotationView alloc] initWithAnnotation:annotation reuseIdentifier:reuseId];
//是否显示callout
 view.canShowCallout = YES;
 //设置左部分的callout：UIImageView
 UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 46, 46)];
 view.leftCalloutAccessoryView = imageView;
 //设置右部分的callout：UIButton
 UIButton *disclosurebutton = [[UIButton alloc] init];
 [disclosurebutton setBackgroundImage:[UIImage imageNamed:@&quot;disclosure&quot;] forState:UIControlStateNormal];
 [disclosurebutton sizeToFit];
 view.rightCalloutAccessoryView = disclosurebutton;
</code></pre><p>  }</p>
<p>  view.annotation = annotation;<br>  return view;</p>
</li>
</ul>
<p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#### 6. 点击大头针，更新callout左侧显示的缩略图</div></pre></td></tr></table></figure></p>
<p>/**</p>
<ul>
<li>点击大头针view<br>*</li>
<li>@param mapView 大头针所属的mapView</li>
<li>@param view    大头针view<br>*/<ul>
<li>(void)mapView:(MKMapView <em>)mapView didSelectAnnotationView:(MKAnnotationView </em>)view<br>{<br>[self updateLeftCalloutAccessoryViewInAnnotationView:view];<br>}</li>
</ul>
</li>
</ul>
<p>/**</p>
<ul>
<li>更新callout里的图片（在左侧）<br>*</li>
<li>@param annotationView 当前被点击的大头针view<br>*/<ul>
<li>(void)updateLeftCalloutAccessoryViewInAnnotationView:(MKAnnotationView <em>)annotationView<br>{<br>UIImageView </em>imageView = nil;<br>if ([annotationView.leftCalloutAccessoryView isKindOfClass:[UIImageView class]]) {<br>  imageView = (UIImageView <em>)annotationView.leftCalloutAccessoryView;<br>}<br>if (imageView) {<br>  Photo </em>photo = nil;<br>  if ([annotationView.annotation isKindOfClass:[Photo class]]) {<pre><code>photo = (Photo *)annotationView.annotation;
</code></pre>  }<br>  if (photo) {<pre><code>NSString *urlString = photo.thumbnailURL;
imageView.image = [UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:urlString]]];
</code></pre>  }<br>}<br>}<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&gt;注意：显示图片的代码：``` imageView.image = [UIImage imageWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:urlString]]];```方法会阻塞主线程，实际操作中应该放在子线程中执行。详情请参考笔者另一篇讲解关于多线程的博客：[最浅显易懂的iOS多线程技术 - GCD的教程](http://www.jianshu.com/p/6e74f5438f2c)。</div><div class="line"></div><div class="line"></div><div class="line">#### 7. 点击callout，在下一页面显示原图</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>/**</p>
<ul>
<li>点击callout实行跳转<br>*</li>
<li>@param mapView 当前的mapView</li>
<li>@param view    当前callout所属的AnnotationView</li>
<li>@param control callout内部被点击的控件<br>*/<ul>
<li>(void)mapView:(MKMapView <em>)mapView annotationView:(MKAnnotationView </em>)view calloutAccessoryControlTapped:(UIControl *)control<br>{<br>[self performSegueWithIdentifier:@”Show Photo” sender:view];<br>}</li>
</ul>
</li>
</ul>
<p>/**</p>
<ul>
<li>调转执行前的代码<br>*</li>
<li>@param segue  连接前后两个控制器的segue</li>
<li><p>@param sender 被点击的AnnotaionView<br>*/</p>
<ul>
<li>(void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender<br>{</li>
</ul>
<p>if ([sender isKindOfClass:[MKAnnotationView class]]) {</p>
<pre><code>[self prepareViewController:segue.destinationViewController
                   forSegue:segue.identifier
           toShowAnnotation:((MKAnnotationView *)sender).annotation];
</code></pre><p>}<br>}</p>
</li>
</ul>
<p>/**</p>
<ul>
<li>为目标控制器准备数据（图片的URL）<br>*</li>
<li>@param vc              目标控制器</li>
<li>@param segueIdentifier segue.identifier</li>
<li>@param annotation      被点击的AnnotaionView<br>*/<ul>
<li>(void)prepareViewController:(id)vc<pre><code>        forSegue:(NSString *)segueIdentifier
toShowAnnotation:(id &lt;MKAnnotation&gt;)annotation
</code></pre>{<br>Photo <em>photo = nil;<br>if ([annotation isKindOfClass:[Photo class]]) {<br>  photo = (Photo </em>)annotation;<br>}<br>if (photo) {<br>  if (![segueIdentifier length] || [segueIdentifier isEqualToString:@”Show Photo”]) {<pre><code>if ([vc isKindOfClass:[ImageViewController class]]) {
    ImageViewController *ivc = (ImageViewController *)vc;
    ivc.imageURL = [NSURL URLWithString:photo.imageURL];
    ivc.title = photo.title;
}
</code></pre>  }<br>}<br>}<br>```<blockquote>
<p>注意：这里的<code>ivc.imageURL = [NSURL URLWithString:photo.imageURL];</code>代码同样会阻塞主线程，实际操作中应该放在子线程来做！</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>而且,本demo的图片地址应该都是在墙外的，所以最好先让电脑翻墙，然后在模拟器上运行比较好。</p>
</blockquote>
<h1 id="最后的话"><a href="#最后的话" class="headerlink" title="最后的话"></a>最后的话</h1><hr>
<p>如果哪位小伙伴想拿到本文Demo的代码请不要客气，可以进入我的<a href="https://github.com/Shijie0111/Stanford_iOS_Lecture_DemoBundle">GitHub</a>下载哦~    这一系列到现在为止的所有Demo都在里面，分为英文注释版本和中文注释版本两种。</p>
<p>十分欢迎给笔者的代码和文笔抛出宝贵的意见和建议~</p>
<p>本文为笔者原创，如需转载，请事先与笔者交涉~</p>

  </section>

</article>
<section class="read-more">
           
    
               
            <div class="read-more-item">
                <span class="read-more-item-dim">最近的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/01/11/斯坦福大学iOS开发公开课总结（十六）：模态视图，UITextField,UImagePickerController，在Flickr添加摄影师照片Demo/" title="斯坦福大学iOS开发公开课总结（十六）：模态视图，UITextField，UImagePickerController，在Flickr添加摄影师照片Demo">斯坦福大学iOS开发公开课总结（十六）：模态视图，UITextField，UImagePickerController，在Flickr添加摄影师照片Demo</a></h2>
                <p class="excerpt">
                
                本节课讲解了模态视图，文本框，UImagePickerController的相关知识，并延续了上一节课的Demo，添加了照相并存储照片的功能。
模态视图
模态视图不同于左右滑入的视图，它是从下往上，覆盖整个屏幕的视图。每次滑入都会重新新建一个控制器。通常用于修改信息等操作。
显示模态视图：1  [s
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-01-11T07:28:46.000Z" class="post-list__meta--date date">2017-01-11</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Objective-C/">Objective-C</a>, <a class="tag-link" href="/tags/iOS/">iOS</a>
</span><a class="btn-border-small" href="/2017/01/11/斯坦福大学iOS开发公开课总结（十六）：模态视图，UITextField,UImagePickerController，在Flickr添加摄影师照片Demo/">继续阅读</a></div>
                           
            </div>
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">更早的文章</span>
                <h2 class="post-list__post-title post-title"><a href="/2017/01/11/斯坦福大学iOS开发公开课总结（十二 十三）：CoreData，表格视图，Flickr摄影师资料列表/" title="斯坦福大学iOS开发公开课总结（十二 十三）：CoreData,表格视图，Flickr摄影师资料列表Demo">斯坦福大学iOS开发公开课总结（十二 十三）：CoreData,表格视图，Flickr摄影师资料列表Demo</a></h2>
                <p class="excerpt">
                
                第十二课和第十三课都介绍了CoreData的知识，并在十三课的中段通过一个Demo来具体实现了CoreData的操作。
笔者之前从未接触过Core Data的相关知识，因此学期这两节课比较吃力，这一篇总结还是有很多需要改进的地方，以后随着对Core Data认识的深入和对这两节课的反复咀嚼，会不断更
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2017-01-11T07:21:28.000Z" class="post-list__meta--date date">2017-01-11</time> &#8226; <span class="post-list__meta--tags tags">于&nbsp;
  <a class="tag-link" href="/tags/Objective-C/">Objective-C</a>, <a class="tag-link" href="/tags/iOS/">iOS</a>
</span><a class="btn-border-small" href="/2017/01/11/斯坦福大学iOS开发公开课总结（十二 十三）：CoreData，表格视图，Flickr摄影师资料列表/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

            
            <footer class="footer">
    <span class="footer__copyright">
        本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2017 - 本站由 <a href="/">@Monniya</a> 创建,
        使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">hexo-theme-new-vno</a> 主题,
        修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
    </span>
</footer>
        </div>
    </div>

    

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    
    </script>
    
</body>
</html>
